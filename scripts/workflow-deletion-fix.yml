# Proposed fix for sync-nocodb.yml workflow to handle deletions

# Add this section after the content generation step (around line 165)
# This will ensure deleted files are properly tracked by git

      # Track all changes including deletions
      - name: Track all content changes including deletions
        if: steps.check-changes.outputs.has-changes == 'true'
        run: |
          # First, add all modified and new files
          git add src/content/episodes/
          git add src/content/guests/
          git add src/content/hosts/
          git add src/content/platforms/
          
          # Then, explicitly add deletions
          # This ensures git tracks removed files
          git add -u src/content/
          
          # Show what will be committed
          echo "Files to be committed:"
          git status --porcelain
          
          # Count deletions for commit message
          DELETED_COUNT=$(git status --porcelain | grep "^D" | wc -l)
          echo "deleted-count=$DELETED_COUNT" >> $GITHUB_OUTPUT

# Update the commit message section to include deletion count:

          COMMIT_MSG="Update podcast content from NocoDB
          
          Episodes: ${EPISODES_CREATED} created, ${EPISODES_UPDATED} updated
          Guests: ${GUESTS_CREATED} created
          Hosts and Platforms updated
          Files deleted: ${DELETED_COUNT}
          
          Generated MDX files with multi-language support and cross-references"