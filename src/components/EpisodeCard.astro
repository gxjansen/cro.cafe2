---
import EpisodeImage from './EpisodeImage.astro';
import { getEpisodeUrl, formatDuration } from '../utils/content';
import type { Language } from '../types';

export interface Props {
  episode: any;
  showLanguage?: boolean;
  size?: 'small' | 'medium' | 'large';
  variant?: 'card' | 'compact';
}

const { episode, showLanguage = true, size = 'medium', variant = 'card' } = Astro.props;

// Language info mapping
const languageInfo = {
  en: { name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
  nl: { name: 'Nederlands', flag: 'ðŸ‡³ðŸ‡±' },
  de: { name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
  es: { name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' }
};

// Size-based classes
const sizeClasses = {
  small: {
    container: 'bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300',
    image: 'w-full h-32',
    padding: 'p-4',
    title: 'text-base font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2',
    description: 'text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2',
    metadata: 'text-xs'
  },
  medium: {
    container: 'bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300',
    image: 'w-full h-48',
    padding: 'p-6',
    title: 'text-lg font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2',
    description: 'text-gray-600 dark:text-gray-300 text-sm mb-4 line-clamp-3',
    metadata: 'text-xs'
  },
  large: {
    container: 'bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300',
    image: 'w-full h-56',
    padding: 'p-6',
    title: 'text-xl font-semibold text-gray-900 dark:text-white mb-2 line-clamp-2',
    description: 'text-gray-600 dark:text-gray-400 mb-4 line-clamp-3',
    metadata: 'text-sm'
  }
};

const classes = sizeClasses[size];
const episodeUrl = getEpisodeUrl(episode);
---

<article class={classes.container}>
  <a href={episodeUrl} class="block">
    <div class="aspect-w-16 aspect-h-9 overflow-hidden">
      <EpisodeImage 
        imageUrl={episode.data.imageUrl} 
        alt={episode.data.title}
        class={classes.image}
      />
    </div>
    <div class={classes.padding}>
      <!-- Episode metadata (season/episode or badge + language) -->
      <div class="flex items-center justify-between mb-3">
        {(episode.data.episode_type === 'trailer' || episode.data.episode_type === 'bonus') ? (
          <span class={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 uppercase`}>
            {episode.data.episode_type}
          </span>
        ) : (
          <span class={`font-medium text-primary-600 dark:text-primary-400 ${classes.metadata}`}>
            S{String(episode.data.season).padStart(2, '0')}E{String(episode.data.episode).padStart(2, '0')}
          </span>
        )}
        {showLanguage && (
          <div class="flex items-center gap-2">
            <span class="text-lg">{languageInfo[episode.data.language].flag}</span>
            <span class={`text-gray-500 dark:text-gray-400 uppercase font-medium ${classes.metadata}`}>
              {languageInfo[episode.data.language].name}
            </span>
          </div>
        )}
      </div>

      <!-- Title -->
      <h3 class={classes.title}>
        {episode.data.title}
      </h3>

      <!-- Description -->
      <p class={classes.description}>
        {episode.data.description}
      </p>

      <!-- Footer metadata (date + duration) -->
      <div class={`flex items-center justify-between text-gray-500 dark:text-gray-400 ${classes.metadata}`}>
        <time datetime={episode.data.pubDate.toISOString()}>
          {episode.data.pubDate.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          })}
        </time>
        <span>{formatDuration(episode.data.duration)}</span>
      </div>
    </div>
  </a>
</article>